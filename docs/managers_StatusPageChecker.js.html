<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding favicon -->
    

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      managers/StatusPageChecker.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-dark.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Home</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><div class="accordion collapsed" id="5886347" > <h3 class="accordion-heading">Classes<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="Badges.html">Badges</a></li><li class="accordion collapsed child" id=3778179><div class="accordion-heading child"><a href="BaseComponent.html">BaseComponent</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="BaseComponent.html#toJSON">toJSON</a></li></ul></li><li class="accordion collapsed child" id=8870908><div class="accordion-heading child"><a href="BaseInteraction.html">BaseInteraction</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="BaseInteraction.html#toJSON">toJSON</a></li></ul></li><li class="accordion-list" id=""><a href="Colors.html">Colors</a></li><li class="accordion collapsed child" id=8707858><div class="accordion-heading child"><a href="ContextInteraction.html">ContextInteraction</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="ContextInteraction.html#load">load</a></li><li data-type='method'><a href="ContextInteraction.html#reload">reload</a></li><li data-type='method'><a href="ContextInteraction.html#unload">unload</a></li></ul></li><li class="accordion collapsed child" id=2632775><div class="accordion-heading child"><a href="ContextInteractionManager.html">ContextInteractionManager</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="ContextInteractionManager.html#deploy">deploy</a></li><li data-type='method'><a href="ContextInteractionManager.html#deployAll">deployAll</a></li><li data-type='method'><a href="ContextInteractionManager.html#load">load</a></li><li data-type='method'><a href="ContextInteractionManager.html#loadAll">loadAll</a></li><li data-type='method'><a href="ContextInteractionManager.html#reload">reload</a></li><li data-type='method'><a href="ContextInteractionManager.html#reloadAll">reloadAll</a></li><li data-type='method'><a href="ContextInteractionManager.html#unload">unload</a></li><li data-type='method'><a href="ContextInteractionManager.html#unloadAll">unloadAll</a></li></ul></li><li class="accordion-list" id=""><a href="DisGroupDevError.html">DisGroupDevError</a></li><li class="accordion-list" id=""><a href="Emojis.html">Emojis</a></li><li class="accordion collapsed child" id=1653375><div class="accordion-heading child"><a href="Event.html">Event</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Event.html#load">load</a></li><li data-type='method'><a href="Event.html#reload">reload</a></li><li data-type='method'><a href="Event.html#toJSON">toJSON</a></li><li data-type='method'><a href="Event.html#unload">unload</a></li></ul></li><li class="accordion collapsed child" id=4831370><div class="accordion-heading child"><a href="EventManager.html">EventManager</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="EventManager.html#load">load</a></li><li data-type='method'><a href="EventManager.html#loadAll">loadAll</a></li><li data-type='method'><a href="EventManager.html#reload">reload</a></li><li data-type='method'><a href="EventManager.html#reloadAll">reloadAll</a></li><li data-type='method'><a href="EventManager.html#unload">unload</a></li><li data-type='method'><a href="EventManager.html#unloadAll">unloadAll</a></li></ul></li><li class="accordion-list" id=""><a href="InteractionManager.html">InteractionManager</a></li><li class="accordion collapsed child" id=3185805><div class="accordion-heading child"><a href="Logger.html">Logger</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Logger.html#debug">debug</a></li><li data-type='method'><a href="Logger.html#error">error</a></li><li data-type='method'><a href="Logger.html#fail">fail</a></li><li data-type='method'><a href="Logger.html#info">info</a></li><li data-type='method'><a href="Logger.html#success">success</a></li><li data-type='method'><a href="Logger.html#warn">warn</a></li></ul></li><li class="accordion-list" id=""><a href="Partner.html">Partner</a></li><li class="accordion collapsed child" id=1290736><div class="accordion-heading child"><a href="SlashCommand.html">SlashCommand</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="SlashCommand.html#deploy">deploy</a></li><li data-type='method'><a href="SlashCommand.html#load">load</a></li><li data-type='method'><a href="SlashCommand.html#reload">reload</a></li><li data-type='method'><a href="SlashCommand.html#toJSON">toJSON</a></li><li data-type='method'><a href="SlashCommand.html#unload">unload</a></li></ul></li><li class="accordion collapsed child" id=179098><div class="accordion-heading child"><a href="SlashCommandInteractionManager.html">SlashCommandInteractionManager</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="SlashCommandInteractionManager.html#deploy">deploy</a></li><li data-type='method'><a href="SlashCommandInteractionManager.html#deployAll">deployAll</a></li><li data-type='method'><a href="SlashCommandInteractionManager.html#load">load</a></li><li data-type='method'><a href="SlashCommandInteractionManager.html#loadAll">loadAll</a></li><li data-type='method'><a href="SlashCommandInteractionManager.html#reload">reload</a></li><li data-type='method'><a href="SlashCommandInteractionManager.html#reloadAll">reloadAll</a></li><li data-type='method'><a href="SlashCommandInteractionManager.html#unload">unload</a></li><li data-type='method'><a href="SlashCommandInteractionManager.html#unloadAll">unloadAll</a></li></ul></li><li class="accordion collapsed child" id=1792622><div class="accordion-heading child"><a href="StatusPageChecker.html">StatusPageChecker</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="StatusPageChecker.html#check">check</a></li><li data-type='method'><a href="StatusPageChecker.html#updateIncident">updateIncident</a></li></ul></li><li class="accordion collapsed child" id=413080><div class="accordion-heading child"><a href="TranslationManager.html">TranslationManager</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="TranslationManager.html#delete">delete</a></li><li data-type='method'><a href="TranslationManager.html#get">get</a></li><li data-type='method'><a href="TranslationManager.html#has">has</a></li><li data-type='method'><a href="TranslationManager.html#list">list</a></li><li data-type='method'><a href="TranslationManager.html#set">set</a></li><li data-type='method'><a href="TranslationManager.html#size">size</a></li><li data-type='method'><a href="TranslationManager.html#translate">translate</a></li></ul></li><li class="accordion collapsed child" id=6289873><div class="accordion-heading child"><a href="Utilities.html">Utilities</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Utilities.html#generateProgressBar">generateProgressBar</a></li><li data-type='method'><a href="Utilities.html#getReadableTime">getReadableTime</a></li></ul></li></ul> </div><div class="accordion collapsed" id="813725" > <h3 class="accordion-heading">Events<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="EventManager.html#event:eventLoad">eventLoad</a></li><li class="accordion-list" id=""><a href="EventManager.html#event:eventReload">eventReload</a></li><li class="accordion-list" id=""><a href="EventManager.html#event:eventUnload">eventUnload</a></li><li class="accordion-list" id=""><a href="InteractionManager.html#event:slashCommandDeploy">slashCommandDeploy</a></li><li class="accordion-list" id=""><a href="InteractionManager.html#event:slashCommandLoad">slashCommandLoad</a></li><li class="accordion-list" id=""><a href="InteractionManager.html#event:slashCommandReload">slashCommandReload</a></li><li class="accordion-list" id=""><a href="InteractionManager.html#event:slashCommandUnload">slashCommandUnload</a></li><li class="accordion-list" id=""><a href="StatusPageChecker.html#event:incidentCheck">incidentCheck</a></li><li class="accordion-list" id=""><a href="StatusPageChecker.html#event:incidentCreate">incidentCreate</a></li><li class="accordion-list" id=""><a href="StatusPageChecker.html#event:incidentUpdate">incidentUpdate</a></li></ul> </div><div class="accordion collapsed" id="2461925" > <h3 class="accordion-heading">Global<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="global.html#BadgeData">BadgeData</a></li><li class="accordion-list" id=""><a href="global.html#BaseComponentData">BaseComponentData</a></li><li class="accordion-list" id=""><a href="global.html#BaseInteractionData">BaseInteractionData</a></li><li class="accordion-list" id=""><a href="global.html#ContextInteractionData">ContextInteractionData</a></li><li class="accordion-list" id=""><a href="global.html#EmojiData">EmojiData</a></li><li class="accordion-list" id=""><a href="global.html#EventData">EventData</a></li><li class="accordion-list" id=""><a href="global.html#EventManagerOptions">EventManagerOptions</a></li><li class="accordion-list" id=""><a href="global.html#ExperimentData">ExperimentData</a></li><li class="accordion-list" id=""><a href="global.html#IncidentData">IncidentData</a></li><li class="accordion-list" id=""><a href="global.html#IncidentDataRaw">IncidentDataRaw</a></li><li class="accordion-list" id=""><a href="global.html#IncidentDataRawComponent">IncidentDataRawComponent</a></li><li class="accordion-list" id=""><a href="global.html#IncidentDataRawComponentUpdate">IncidentDataRawComponentUpdate</a></li><li class="accordion-list" id=""><a href="global.html#IncidentDataRawUpdate">IncidentDataRawUpdate</a></li><li class="accordion-list" id=""><a href="global.html#InteractionManagerOptions">InteractionManagerOptions</a></li><li class="accordion-list" id=""><a href="global.html#LoadAllOptions">LoadAllOptions</a></li><li class="accordion-list" id=""><a href="global.html#LogData">LogData</a></li><li class="accordion-list" id=""><a href="global.html#LoggerIcons">LoggerIcons</a></li><li class="accordion-list" id=""><a href="global.html#LoggerOptions">LoggerOptions</a></li><li class="accordion-list" id=""><a href="global.html#PartnerData">PartnerData</a></li><li class="accordion-list" id=""><a href="global.html#SlashCommandData">SlashCommandData</a></li><li class="accordion-list" id=""><a href="global.html#StatusPageCheckerOptions">StatusPageCheckerOptions</a></li><li class="accordion-list" id=""><a href="global.html#StatusPageCheckerOptionsColors">StatusPageCheckerOptionsColors</a></li><li class="accordion-list" id=""><a href="global.html#TranslateOptions">TranslateOptions</a></li><li class="accordion-list" id=""><a href="global.html#TranslationData">TranslationData</a></li><li class="accordion-list" id=""><a href="global.html#TranslationManagerOptions">TranslationManagerOptions</a></li></ul> </div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        managers/StatusPageChecker.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { Collection, MessageEmbed, Snowflake, WebhookClient } = require('discord.js');
const { DateTime } = require('luxon');
const EventEmitter = require('node:events');
const FileSystem = require('node:fs');
const Fetch = import('node-fetch');

const { DisGroupDevError, Messages } = require('../errors/DisGroupDevError');

let loadedIncidents = false;

/**
 * @typedef {Object} IncidentData
 * @property {String} id The id of the incident
 * @property {String} lastUpdate The last update of the incident
 * @property {Snowflake} messageId The id of the message of the incident
 * @property {Boolean} resolved If the incident is resolved
 */

/**
 * @typedef {Object} IncidentDataRaw
 * @property {IncidentDataRawComponents[]} components The components of the incident
 * @property {String} created_at The creation date of the incident
 * @property {String} id The id of the incident
 * @property {String} impact The impact of the incident
 * @property {IncidentDataRawComponentUpdate[]} incident_updates The updates of the incident
 * @property {String} monitoring_at The monitoring date of the incident
 * @property {String} name The name of the incident
 * @property {String} page_id The id of the status page
 * @property {String} resolved_at The resolved date of the incident
 * @property {String} shortlink The link of the incident
 * @property {String} started_at The start date of the incident
 * @property {String} status The status of the incident
 * @property {String} updated_at The last update of the incident
 */

/**
 * @typedef {Object} IncidentDataRawComponent
 * @property {String} created_at The creation date of the component
 * @property {String} description The description of the component
 * @property {Boolean} group If the component is a group
 * @property {String|null} group_id The id of the group of the component
 * @property {String} id The id of the component
 * @property {String} name The name of the component
 * @property {Boolean} only_show_if_degraded If the component is only shown if degraded
 * @property {String} page_id The id of the status page
 * @property {Number} position The position of the component
 * @property {Boolean} showcase If the component is in the showcase
 * @property {String|null} start_date The start date of the component
 * @property {String} status The status of the component
 * @property {String} updated_at The last update of the component
 */

/**
 * @typedef {Object} IncidentDataRawComponentUpdate
 * @property {String} code The code of the component update
 * @property {String} name The name of the component update
 * @property {String} new_status The new status of the component update
 * @property {String} old_status The old status of the component update
 */

/**
 * @typedef {Object} IncidentDataRawUpdate
 * @property {IncidentDataRawComponentUpdate[]} affected_components The affected components of the update
 * @property {String} body The body of the update
 * @property {String} created_at The creation date of the update
 * @property {String|null} custom_tweet The custom tweet of the update
 * @property {Boolean} deliver_notifications If the update should be delivered to the users
 * @property {String} display_at The display date of the update
 * @property {String} id The id of the incident update
 * @property {String} incident_id The id of the incident
 * @property {String} status The status of the incident update
 * @property {String|null} tweet_id The id of the tweet of the update
 * @property {String} update_at The date of the incident update
 */

/**
 * @typedef {Object} StatusPageCheckerOptions
 * @property {Number} checkInterval The time in ms the checker should check (default: 60000)
 * @property {StatusPageCheckerOptionsColors} colors The colors of the embeds
 * @property {String} storage The json file to save the incidents to
 * @property {String} url The URL of the status page you want to monitore
 * @property {WebhookClient} webhook webhook client
 */

/**
 * @typedef {Object} StatusPageCheckerOptionsColors
 * @property {String} BLACK (default: #000000)
 * @property {String} GREEN (default: #51f34d)
 * @property {String} ORANGE (default: #fcb22d)
 * @property {String} RED (default: #fe6b61)
 * @property {String} YELLOW (default: #ffde22)
 */

/**
 * The status page checker.
 * Inspired by @almostSouji
 * @extends {EventEmitter}
 * @class
 */
class StatusPageChecker extends EventEmitter {

    /**
     * The constructor of the status page checker class.
     * @param {StatusPageCheckerOptions} options
     */
    constructor(options = { colors: { BLACK: '#000000', GREEN: '#51f34d', ORANGE: '#fcb22d', RED: '#fe6b61', YELLOW: '#ffde22' } }) {

        super();

        /**
         * The cache with all page incidents
         * @type {Collection&lt;String, IncidentData>}
         * @public
         */
        this.incidents = new Collection();

        /**
         * The options of the status page checker.
         * @type {StatusPageCheckerOptions}
         * @public
         */
        this.options = options;

        if(!options?.storage || typeof options.storage !== 'string') throw new DisGroupDevError(Messages.INVALID_LOCATION);
        if(!options?.url || typeof options.url !== 'string') throw new DisGroupDevError(Messages.INVALID_URL);
        if(!options?.webhook || !options.webhook instanceof WebhookClient) throw new DisGroupDevError(Messages.NOT_INSTANCE_OF(options?.webhook, WebhookClient));

        /**
         * The webhook client.
         * @type {WebhookClient}
         * @public
         */
        this.webhook = options.webhook;

        this.check();

        setInterval(() => this.check(), this.options.checkInterval ?? 60_000);

    }

    /**
     * Fetches the status page
     * @returns {Promise&lt;Fetch.Response>}
     * @private
     */
    async _fetch() {

        const data = await (await Fetch).default(`${this.options.url}/api/v2/incidents.json`).then((r => r.json()));

        return data;

    }

    /**
     * Generates an incident embed
     * @param {IncidentDataRaw} incident
     * @returns {Promise&lt;MessageEmbed>}
     * @private
     */
    _generateEmbed(incident) {

        return new Promise(async (resolve, reject) => {

            try {

                const embedColor =
                    incident.status === 'resolved' || incident.status === 'postmortem'
                        ? this.options.colors.GREEN : incident.impact === 'critical'
                            ? this.options.colors.RED : incident.impact === 'major'
                                ? this.options.colors.ORANGE : incident.impact === 'minor'
                                    ? this.options.colors.YELLOW : this.options.colors.BLACK;

                const affectedComponentsNames = incident.components.map((c) => c.name);

                const embed = new MessageEmbed()
                    .setTitle(incident.name)
                    .setColor(embedColor)
                    .setFooter({ text: `ID: ${incident.id}` })
                    .setTimestamp(new Date(incident.started_at))
                    .setURL(incident.shortlink)

                for(const incidentUpdate of incident.incident_updates.reverse()) {

                    const incidentUpdateDate = DateTime.fromISO(incidentUpdate.created_at);
                    const incidentUpdateDateTimeStamp = `&lt;t:${Math.floor(incidentUpdateDate.toSeconds())}:R>`;

                    embed.addField(`${incidentUpdate.status.charAt(0).toUpperCase()}${incidentUpdate.status.slice(1)} (${incidentUpdateDateTimeStamp})`, incidentUpdate.body);

                }

                const embedDescriptionParts = [`・ Impact: ${incident.impact}`];

                if(affectedComponentsNames.length) embedDescriptionParts.push(`・ Affected components: ${affectedComponentsNames.join(', ')}`);

                embed.setDescription(embedDescriptionParts.join('\n'));

                resolve(embed);

            } catch(e) {

                reject(new DisGroupDevError(e));

            }

        });

    }

    /**
     * Loads all incidents from the storage file
     * @returns {Promise&lt;Boolean|DisGroupDevError>}
     * @private
     */
    _loadIncidents() {

        return new Promise(async (resolve, reject) => {

            try {

                const rawData = await this._loadRawIncidents();

                await rawData.forEach(rawDataIncident => {

                    this.incidents.set(rawDataIncident.id, {
                        id: rawDataIncident.id,
                        lastUpdate: rawDataIncident.lastUpdate,
                        messageId: rawDataIncident.messageId,
                        resolved: rawDataIncident.resolved
                    });

                });

                loadedIncidents = true;

                resolve(true);

            } catch(e) {

                reject(new DisGroupDevError(e));

            }

        });

    }

    /**
     * Loads all incidents raw from the storage file
     * @returns {Promise&lt;Array&lt;IncidentData>>}
     * @private
     */
    _loadRawIncidents() {

        return new Promise(async (resolve, reject) => {

            const storage = await require('util').promisify(FileSystem.exists)(this.options.storage);

            if(!storage) {

                await require('util').promisify(FileSystem.writeFile)(this.options.storage, JSON.stringify(new Array()), 'utf-8');

                resolve([]);

            } else {

                const storageContent = await require('util').promisify(FileSystem.readFile)(this.options.storage);

                try {

                    const storageIncidents = await JSON.parse(storageContent.toString());

                    if(Array.isArray(storageIncidents)) {

                        resolve(storageIncidents)

                    } else {

                        resolve([]);

                    }

                } catch (e) {

                    resolve([]);

                }

            }

        });

    }

    /**
     * Saves the incidents to the file
     * @returns {Promise&lt;Boolean>}
     * @private
     */
    async _save() {

        await require('util').promisify(FileSystem.writeFile)(this.options.storage, JSON.stringify(this.incidents, null, 4), 'utf-8');

        return true;

    }

    /**
     * The check function
     * @returns {Promise&lt;Boolean|DisGroupDevError>}
     * @public
     */
    async check() {

        if(!loadedIncidents) {

            await this._loadIncidents();

            return this.check();

        }

        /**
         * Emitted when a check has started.
         * @event StatusPageChecker#incidentCheck
         */
        this.emit('incidentCheck');

        try {

            const fetched = await this._fetch();
            /** @type {IncidentDataRaw[]} */
            const fetchedIncidents = fetched.incidents;

            for(const incident of fetchedIncidents?.reverse()) {

                const incidentData = this.incidents.get(incident.id);

                if(!incidentData) {

                    /**
                     * Emitted when a new incident has been found
                     * @event StatusPageChecker#incidentCreate
                     * @param {IncidentData} incidentData
                     */
                    this.emit('incidentCreate', incidentData);

                    return this.updateIncident(incident);

                }

                const incidentUpdate = DateTime.fromISO(incident.updated_at ?? incident.created_at);

                if(DateTime.fromISO(incidentData.lastUpdate) &lt; incidentUpdate) {

                    /**
                     * Emitted when an incident has been updated
                     * @event StatusPageChecker#incidentUpdate
                     * @param {IncidentData} incidentData
                     */
                    this.emit('incidentUpdate', incidentData);

                    return this.updateIncident(incident, incidentData.messageId);

                }

            }

        } catch (e) {

            throw new DisGroupDevError(e);

        }

    }

    /**
     * Updates an incident
     * @param {IncidentDataRaw} incident The raw data of the incident
     * @param {?String} messageId The id of the webhook message
     * @returns {Promise&lt;Boolean|DisGroupDevError>}
     */
    updateIncident(incident, messageId = null) {

        return new Promise(async (resolve, reject) => {

            const embed = await this._generateEmbed(incident);

            try {

                const webhookMessage = await ((messageId &amp;&amp; typeof messageId === 'string') ? this.webhook.editMessage(messageId, { embeds: [embed] }) : this.webhook.send({ embeds: [embed] }));

                this.incidents.set(incident.id, {

                    id: incident.id,
                    lastUpdate: DateTime.now().toISO(),
                    messageId: webhookMessage.id,
                    resolved: incident.status === 'resolved' || incident.status === 'postmortem'

                });

                await this._save();

                resolve(true);

            } catch(e) {

                reject(new DisGroupDevError(e))

            }

        });

    }

}

module.exports = StatusPageChecker;</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"Badges","link":"<a href=\"Badges.html\">Badges</a>"},{"title":"BaseComponent","link":"<a href=\"BaseComponent.html\">BaseComponent</a>"},{"title":"BaseComponent#toJSON","link":"<a href=\"BaseComponent.html#toJSON\">BaseComponent &rtrif; toJSON</a>"},{"title":"BaseInteraction","link":"<a href=\"BaseInteraction.html\">BaseInteraction</a>"},{"title":"BaseInteraction#toJSON","link":"<a href=\"BaseInteraction.html#toJSON\">BaseInteraction &rtrif; toJSON</a>"},{"title":"Colors","link":"<a href=\"Colors.html\">Colors</a>"},{"title":"ContextInteraction","link":"<a href=\"ContextInteraction.html\">ContextInteraction</a>"},{"title":"ContextInteraction#load","link":"<a href=\"ContextInteraction.html#load\">ContextInteraction &rtrif; load</a>"},{"title":"ContextInteraction#reload","link":"<a href=\"ContextInteraction.html#reload\">ContextInteraction &rtrif; reload</a>"},{"title":"ContextInteraction#unload","link":"<a href=\"ContextInteraction.html#unload\">ContextInteraction &rtrif; unload</a>"},{"title":"ContextInteractionManager","link":"<a href=\"ContextInteractionManager.html\">ContextInteractionManager</a>"},{"title":"ContextInteractionManager#deploy","link":"<a href=\"ContextInteractionManager.html#deploy\">ContextInteractionManager &rtrif; deploy</a>"},{"title":"ContextInteractionManager#deployAll","link":"<a href=\"ContextInteractionManager.html#deployAll\">ContextInteractionManager &rtrif; deployAll</a>"},{"title":"ContextInteractionManager#load","link":"<a href=\"ContextInteractionManager.html#load\">ContextInteractionManager &rtrif; load</a>"},{"title":"ContextInteractionManager#loadAll","link":"<a href=\"ContextInteractionManager.html#loadAll\">ContextInteractionManager &rtrif; loadAll</a>"},{"title":"ContextInteractionManager#reload","link":"<a href=\"ContextInteractionManager.html#reload\">ContextInteractionManager &rtrif; reload</a>"},{"title":"ContextInteractionManager#reloadAll","link":"<a href=\"ContextInteractionManager.html#reloadAll\">ContextInteractionManager &rtrif; reloadAll</a>"},{"title":"ContextInteractionManager#unload","link":"<a href=\"ContextInteractionManager.html#unload\">ContextInteractionManager &rtrif; unload</a>"},{"title":"ContextInteractionManager#unloadAll","link":"<a href=\"ContextInteractionManager.html#unloadAll\">ContextInteractionManager &rtrif; unloadAll</a>"},{"title":"DisGroupDevError","link":"<a href=\"DisGroupDevError.html\">DisGroupDevError</a>"},{"title":"Emojis","link":"<a href=\"Emojis.html\">Emojis</a>"},{"title":"Event","link":"<a href=\"Event.html\">Event</a>"},{"title":"Event#load","link":"<a href=\"Event.html#load\">Event &rtrif; load</a>"},{"title":"Event#reload","link":"<a href=\"Event.html#reload\">Event &rtrif; reload</a>"},{"title":"Event#toJSON","link":"<a href=\"Event.html#toJSON\">Event &rtrif; toJSON</a>"},{"title":"Event#unload","link":"<a href=\"Event.html#unload\">Event &rtrif; unload</a>"},{"title":"EventManager","link":"<a href=\"EventManager.html\">EventManager</a>"},{"title":"EventManager#load","link":"<a href=\"EventManager.html#load\">EventManager &rtrif; load</a>"},{"title":"EventManager#loadAll","link":"<a href=\"EventManager.html#loadAll\">EventManager &rtrif; loadAll</a>"},{"title":"EventManager#reload","link":"<a href=\"EventManager.html#reload\">EventManager &rtrif; reload</a>"},{"title":"EventManager#reloadAll","link":"<a href=\"EventManager.html#reloadAll\">EventManager &rtrif; reloadAll</a>"},{"title":"EventManager#unload","link":"<a href=\"EventManager.html#unload\">EventManager &rtrif; unload</a>"},{"title":"EventManager#unloadAll","link":"<a href=\"EventManager.html#unloadAll\">EventManager &rtrif; unloadAll</a>"},{"title":"InteractionManager","link":"<a href=\"InteractionManager.html\">InteractionManager</a>"},{"title":"Logger","link":"<a href=\"Logger.html\">Logger</a>"},{"title":"Logger#debug","link":"<a href=\"Logger.html#debug\">Logger &rtrif; debug</a>"},{"title":"Logger#error","link":"<a href=\"Logger.html#error\">Logger &rtrif; error</a>"},{"title":"Logger#fail","link":"<a href=\"Logger.html#fail\">Logger &rtrif; fail</a>"},{"title":"Logger#info","link":"<a href=\"Logger.html#info\">Logger &rtrif; info</a>"},{"title":"Logger#success","link":"<a href=\"Logger.html#success\">Logger &rtrif; success</a>"},{"title":"Logger#warn","link":"<a href=\"Logger.html#warn\">Logger &rtrif; warn</a>"},{"title":"Partner","link":"<a href=\"Partner.html\">Partner</a>"},{"title":"SlashCommand","link":"<a href=\"SlashCommand.html\">SlashCommand</a>"},{"title":"SlashCommand#deploy","link":"<a href=\"SlashCommand.html#deploy\">SlashCommand &rtrif; deploy</a>"},{"title":"SlashCommand#load","link":"<a href=\"SlashCommand.html#load\">SlashCommand &rtrif; load</a>"},{"title":"SlashCommand#reload","link":"<a href=\"SlashCommand.html#reload\">SlashCommand &rtrif; reload</a>"},{"title":"SlashCommand#toJSON","link":"<a href=\"SlashCommand.html#toJSON\">SlashCommand &rtrif; toJSON</a>"},{"title":"SlashCommand#unload","link":"<a href=\"SlashCommand.html#unload\">SlashCommand &rtrif; unload</a>"},{"title":"SlashCommandInteractionManager","link":"<a href=\"SlashCommandInteractionManager.html\">SlashCommandInteractionManager</a>"},{"title":"SlashCommandInteractionManager#deploy","link":"<a href=\"SlashCommandInteractionManager.html#deploy\">SlashCommandInteractionManager &rtrif; deploy</a>"},{"title":"SlashCommandInteractionManager#deployAll","link":"<a href=\"SlashCommandInteractionManager.html#deployAll\">SlashCommandInteractionManager &rtrif; deployAll</a>"},{"title":"SlashCommandInteractionManager#load","link":"<a href=\"SlashCommandInteractionManager.html#load\">SlashCommandInteractionManager &rtrif; load</a>"},{"title":"SlashCommandInteractionManager#loadAll","link":"<a href=\"SlashCommandInteractionManager.html#loadAll\">SlashCommandInteractionManager &rtrif; loadAll</a>"},{"title":"SlashCommandInteractionManager#reload","link":"<a href=\"SlashCommandInteractionManager.html#reload\">SlashCommandInteractionManager &rtrif; reload</a>"},{"title":"SlashCommandInteractionManager#reloadAll","link":"<a href=\"SlashCommandInteractionManager.html#reloadAll\">SlashCommandInteractionManager &rtrif; reloadAll</a>"},{"title":"SlashCommandInteractionManager#unload","link":"<a href=\"SlashCommandInteractionManager.html#unload\">SlashCommandInteractionManager &rtrif; unload</a>"},{"title":"SlashCommandInteractionManager#unloadAll","link":"<a href=\"SlashCommandInteractionManager.html#unloadAll\">SlashCommandInteractionManager &rtrif; unloadAll</a>"},{"title":"StatusPageChecker","link":"<a href=\"StatusPageChecker.html\">StatusPageChecker</a>"},{"title":"StatusPageChecker#check","link":"<a href=\"StatusPageChecker.html#check\">StatusPageChecker &rtrif; check</a>"},{"title":"StatusPageChecker#updateIncident","link":"<a href=\"StatusPageChecker.html#updateIncident\">StatusPageChecker &rtrif; updateIncident</a>"},{"title":"TranslationManager","link":"<a href=\"TranslationManager.html\">TranslationManager</a>"},{"title":"TranslationManager#delete","link":"<a href=\"TranslationManager.html#delete\">TranslationManager &rtrif; delete</a>"},{"title":"TranslationManager#get","link":"<a href=\"TranslationManager.html#get\">TranslationManager &rtrif; get</a>"},{"title":"TranslationManager#has","link":"<a href=\"TranslationManager.html#has\">TranslationManager &rtrif; has</a>"},{"title":"TranslationManager#list","link":"<a href=\"TranslationManager.html#list\">TranslationManager &rtrif; list</a>"},{"title":"TranslationManager#set","link":"<a href=\"TranslationManager.html#set\">TranslationManager &rtrif; set</a>"},{"title":"TranslationManager#size","link":"<a href=\"TranslationManager.html#size\">TranslationManager &rtrif; size</a>"},{"title":"TranslationManager#translate","link":"<a href=\"TranslationManager.html#translate\">TranslationManager &rtrif; translate</a>"},{"title":"Utilities","link":"<a href=\"Utilities.html\">Utilities</a>"},{"title":"Utilities#generateProgressBar","link":"<a href=\"Utilities.html#generateProgressBar\">Utilities &rtrif; generateProgressBar</a>"},{"title":"Utilities#getReadableTime","link":"<a href=\"Utilities.html#getReadableTime\">Utilities &rtrif; getReadableTime</a>"},{"title":"eventLoad","link":"<a href=\"EventManager.html#event:eventLoad\">eventLoad</a>"},{"title":"eventReload","link":"<a href=\"EventManager.html#event:eventReload\">eventReload</a>"},{"title":"eventUnload","link":"<a href=\"EventManager.html#event:eventUnload\">eventUnload</a>"},{"title":"slashCommandDeploy","link":"<a href=\"InteractionManager.html#event:slashCommandDeploy\">slashCommandDeploy</a>"},{"title":"slashCommandLoad","link":"<a href=\"InteractionManager.html#event:slashCommandLoad\">slashCommandLoad</a>"},{"title":"slashCommandReload","link":"<a href=\"InteractionManager.html#event:slashCommandReload\">slashCommandReload</a>"},{"title":"slashCommandUnload","link":"<a href=\"InteractionManager.html#event:slashCommandUnload\">slashCommandUnload</a>"},{"title":"incidentCheck","link":"<a href=\"StatusPageChecker.html#event:incidentCheck\">incidentCheck</a>"},{"title":"incidentCreate","link":"<a href=\"StatusPageChecker.html#event:incidentCreate\">incidentCreate</a>"},{"title":"incidentUpdate","link":"<a href=\"StatusPageChecker.html#event:incidentUpdate\">incidentUpdate</a>"},{"title":"BadgeData","link":"<a href=\"global.html#BadgeData\">BadgeData</a>"},{"title":"BaseComponentData","link":"<a href=\"global.html#BaseComponentData\">BaseComponentData</a>"},{"title":"BaseInteractionData","link":"<a href=\"global.html#BaseInteractionData\">BaseInteractionData</a>"},{"title":"ContextInteractionData","link":"<a href=\"global.html#ContextInteractionData\">ContextInteractionData</a>"},{"title":"EmojiData","link":"<a href=\"global.html#EmojiData\">EmojiData</a>"},{"title":"EventData","link":"<a href=\"global.html#EventData\">EventData</a>"},{"title":"EventManagerOptions","link":"<a href=\"global.html#EventManagerOptions\">EventManagerOptions</a>"},{"title":"ExperimentData","link":"<a href=\"global.html#ExperimentData\">ExperimentData</a>"},{"title":"IncidentData","link":"<a href=\"global.html#IncidentData\">IncidentData</a>"},{"title":"IncidentDataRaw","link":"<a href=\"global.html#IncidentDataRaw\">IncidentDataRaw</a>"},{"title":"IncidentDataRawComponent","link":"<a href=\"global.html#IncidentDataRawComponent\">IncidentDataRawComponent</a>"},{"title":"IncidentDataRawComponentUpdate","link":"<a href=\"global.html#IncidentDataRawComponentUpdate\">IncidentDataRawComponentUpdate</a>"},{"title":"IncidentDataRawUpdate","link":"<a href=\"global.html#IncidentDataRawUpdate\">IncidentDataRawUpdate</a>"},{"title":"InteractionManagerOptions","link":"<a href=\"global.html#InteractionManagerOptions\">InteractionManagerOptions</a>"},{"title":"LoadAllOptions","link":"<a href=\"global.html#LoadAllOptions\">LoadAllOptions</a>"},{"title":"LogData","link":"<a href=\"global.html#LogData\">LogData</a>"},{"title":"LoggerIcons","link":"<a href=\"global.html#LoggerIcons\">LoggerIcons</a>"},{"title":"LoggerOptions","link":"<a href=\"global.html#LoggerOptions\">LoggerOptions</a>"},{"title":"PartnerData","link":"<a href=\"global.html#PartnerData\">PartnerData</a>"},{"title":"SlashCommandData","link":"<a href=\"global.html#SlashCommandData\">SlashCommandData</a>"},{"title":"StatusPageCheckerOptions","link":"<a href=\"global.html#StatusPageCheckerOptions\">StatusPageCheckerOptions</a>"},{"title":"StatusPageCheckerOptionsColors","link":"<a href=\"global.html#StatusPageCheckerOptionsColors\">StatusPageCheckerOptionsColors</a>"},{"title":"TranslateOptions","link":"<a href=\"global.html#TranslateOptions\">TranslateOptions</a>"},{"title":"TranslationData","link":"<a href=\"global.html#TranslationData\">TranslationData</a>"},{"title":"TranslationManagerOptions","link":"<a href=\"global.html#TranslationManagerOptions\">TranslationManagerOptions</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    

    

    


  </body>

</html>
