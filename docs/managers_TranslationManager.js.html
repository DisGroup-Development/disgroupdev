<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: managers/TranslationManager.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: managers/TranslationManager.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const FileSystem = require("node:fs");
const I18Next = require('i18next');
const I18NextFSBackend = require('i18next-fs-backend');
const Path = require('path');
const Util = require("node:util");

let isReady = false;

/**
 * @typedef {Object} TranslationManagerOptions
 * @property {String} locationTranslations The location of the translations
 * @property {I18Next.InitOptions} i18nextOptions The options for i18next
 */

/**
 * The translation manager for managing translations
 */
class TranslationManager {

    /**
     * The constructor for the TranslationManager
     * @param {TranslationManagerOptions} options
     */
    constructor(options) {

        /**
         * The array of all namespaces
         * @type {?[]}
         * @private
         */
        this._namespaces = null;

        /**
         * The collection of all translations
         * @type {?Map&lt;String, Function>}
         * @private
         */
        this._translations = null;

        /**
         * The options of the translation manager
         * @type {TranslationManagerOptions}
         */
        this.options = options;

        /**
         * Reads a directory
         * @private
         */
        this.readDirectory = Util.promisify(FileSystem.readdir);

        /**
         * Stats a directory
         * @private
         */
        this.statDirectory = Util.promisify(FileSystem.stat);

        this._init().then(() => isReady = true);

    }

    /**
     * Inits 18next and the backend
     * @private
     */
    async _init() {

        const I18NextBackend = new I18NextFSBackend()
        const { namespaces, totalLanguages } = await this._loadAll("", this.options.locationTranslations, []);

        I18Next.use(I18NextBackend);

        await I18Next.init({

            backend: {
                jsonIndent: 4,
                loadPath: Path.resolve(this.options.locationTranslations, './{{lng}}/{{ns}}.json')
            },
            preload: totalLanguages,
            ns: namespaces,
            ...this.options.i18nextOptions

        });

        this._namespaces = namespaces;
        this._translations = new Map(totalLanguages.map(lng => [lng, I18Next.getFixedT(lng)]));

    }

    async _loadAll(folderName = '', translationDir, namespaces = []) {

        const translationDirectory = await this.readDirectory(translationDir);

        let totalLanguages = [];

        for(const translationFile of translationDirectory) {

            const translationStat = await this.statDirectory(Path.resolve(translationDir, translationFile));

            if(translationStat.isDirectory()) {

                const isTranslationFile = translationFile.includes('-');

                if(isTranslationFile) totalLanguages.push(translationFile);

                const translationFolder = await this._loadAll( isTranslationFile ? '' : `${translationFile}/`, Path.join(translationDir, translationFile), namespaces);

                namespaces = translationFolder.namespaces;

            } else {

                namespaces.push(`${folderName}${translationFile.substring(0, translationFile.length - 5)}`);

            }

        }

        return { namespaces: [...new Set(namespaces)], totalLanguages };

    }

    /**
     * Deletes a translation
     * @param {String} name The name of the translation
     * @returns {?Boolean}
     */
    delete(name) {

        if(!isReady) return null;

        const translation = this._translations.get(name);

        if(!translation) return null;

        this._translations.delete(name);

        return true;

    }

    /**
     * Gets a translation
     * @param {String} name The name of the translation
     * @returns {?Function}
     */
    get(name) {

        if(!isReady) return null;

        const translation = this._translations.get(name);

        return translation ?? null;

    }

    /**
     * Translate an string
     * @param {String} name The name of the translation
     * @param {String} key The key of the translation (Default category/file:KEY)
     * @param {?Object} args The arguments of the translation
     * @return {?String}
     */
    translate(name, key, args = {}) {

        const translation = this.get(name);

        return translation(key, args) ?? null;

    }

}

module.exports = TranslationManager;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BackUp.html">BackUp</a></li><li><a href="BackUpManager.html">BackUpManager</a></li><li><a href="Badges.html">Badges</a></li><li><a href="Base.html">Base</a></li><li><a href="BaseCommand.html">BaseCommand</a></li><li><a href="BaseInteraction.html">BaseInteraction</a></li><li><a href="ButtonInteraction.html">ButtonInteraction</a></li><li><a href="ButtonInteractionManager.html">ButtonInteractionManager</a></li><li><a href="Colors.html">Colors</a></li><li><a href="Command.html">Command</a></li><li><a href="CommandManager.html">CommandManager</a></li><li><a href="Emojis.html">Emojis</a></li><li><a href="Event.html">Event</a></li><li><a href="EventManager.html">EventManager</a></li><li><a href="InteractionManager.html">InteractionManager</a></li><li><a href="Logger.html">Logger</a></li><li><a href="MenuInteraction.html">MenuInteraction</a></li><li><a href="MenuInteractionManager.html">MenuInteractionManager</a></li><li><a href="MessageInteraction.html">MessageInteraction</a></li><li><a href="MessageInteractionManager.html">MessageInteractionManager</a></li><li><a href="ModalInteraction.html">ModalInteraction</a></li><li><a href="ModalInteractionManager.html">ModalInteractionManager</a></li><li><a href="Partner.html">Partner</a></li><li><a href="Route.html">Route</a></li><li><a href="SlashCommand.html">SlashCommand</a></li><li><a href="SlashCommandManager.html">SlashCommandManager</a></li><li><a href="TempChannelManager.html">TempChannelManager</a></li><li><a href="TextTicket.html">TextTicket</a></li><li><a href="TextTicketManager.html">TextTicketManager</a></li><li><a href="TranslationManager.html">TranslationManager</a></li><li><a href="UserInteraction.html">UserInteraction</a></li><li><a href="UserInteractionManager.html">UserInteractionManager</a></li><li><a href="Utilities.html">Utilities</a></li></ul><h3>Events</h3><ul><li><a href="TextTicketManager.html#event:ticketClosed">ticketClosed</a></li><li><a href="TextTicketManager.html#event:ticketCreated">ticketCreated</a></li><li><a href="TextTicketManager.html#event:ticketDeleted">ticketDeleted</a></li><li><a href="TextTicketManager.html#event:ticketRenamed">ticketRenamed</a></li><li><a href="TextTicketManager.html#event:ticketReopened">ticketReopened</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Thu Mar 31 2022 15:39:04 GMT+0200 (Mitteleurop√§ische Sommerzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
